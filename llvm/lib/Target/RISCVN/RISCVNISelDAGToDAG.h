#ifndef LLVM_LIB_TARGET_RISCVN_RISCVNISELDAGTODAG_H
#define LLVM_LIB_TARGET_RISCVN_RISCVNISELDAGTODAG_H

#include "MCTargetDesc/RISCVNMCTargetDesc.h"
#include "RISCVN.h"
#include "RISCVNTargetMachine.h"
#include "llvm/CodeGen/SelectionDAGISel.h"

namespace llvm {

class RISCVNDAGToDAGISel : public SelectionDAGISel {
  const RISCVNSubtarget *Subtarget = nullptr;

public:
  RISCVNDAGToDAGISel() = delete;

  explicit RISCVNDAGToDAGISel(RISCVNTargetMachine &TargetMachine,
                              CodeGenOptLevel OptLevel)
      : SelectionDAGISel(TargetMachine, OptLevel) {}

  bool runOnMachineFunction(MachineFunction &MF) override {
    Subtarget = &MF.getSubtarget<RISCVNSubtarget>();
    return SelectionDAGISel::runOnMachineFunction(MF);
  }

  void Select(SDNode *Node) override;

  bool SelectFrameAddrRegImm(SDValue Addr, SDValue &Base, SDValue &Offset);

  bool SelectAddrFrameIndex(SDValue Addr, SDValue &Base, SDValue &Offset);

// Include the pieces autogenerated from the target description.
#include "RISCVNGenDAGISel.inc"
};

class RISCVNDAGToDAGISelLegacy : public SelectionDAGISelLegacy {
public:
  static char ID;
  explicit RISCVNDAGToDAGISelLegacy(RISCVNTargetMachine &TM,
                                    CodeGenOptLevel OptLevel)
      : SelectionDAGISelLegacy(
            ID, std::make_unique<RISCVNDAGToDAGISel>(TM, OptLevel)) {}
};
} // namespace llvm

#endif